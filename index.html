
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Boulder County Homicides Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    html, body { margin: 0; height: 100%; background: #0a0a0a; font-family: Arial, sans-serif; }
    #map { position: absolute; inset: 0; }
    .panel {
      position: absolute;
      right: -400px;
      top: 0;
      width: 380px;
      height: 100%;
      background: rgba(15, 23, 42, 0.96);
      border-left: 1px solid rgba(255,255,255,0.15);
      color: white;
      padding: 20px;
      transition: 0.3s;
      overflow-y: auto;
    }
    .panel.open { right: 0; }
    .panel h2 { font-family: Georgia, serif; margin-top: 0; }
    .hover-label {
      position: absolute;
      display: none;
      padding: 6px 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 11px;
      border-radius: 6px;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="hover" class="hover-label"></div>

  <div id="info-panel" class="panel">
    <h2 id="panel-title"></h2>
    <p id="panel-summary"></p>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
const map = L.map('map').setView([40.05, -105.28], 11);

L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
  maxZoom: 19,
  attribution: '&copy; CARTO &copy; OpenStreetMap contributors'
}).addTo(map);

function styleFromCoverage(c) {
  c = (c || "").toLowerCase();
  if (c.startsWith("high")) return { color: "#b91c1c", radius: 14 };
  if (c.startsWith("medium")) return { color: "#f97316", radius: 9 };
  return { color: "#6b7280", radius: 6 };
}

function openPanel(c) {
  document.getElementById("panel-title").innerText = `${c.case_name} (${c.year})`;
  document.getElementById("panel-summary").innerText = c.summary;
  document.getElementById("info-panel").classList.add("open");
}

Papa.parse("cases.csv", {
  download: true,
  header: true,
  complete: res => {
    res.data.forEach(c => {
      if(!c.latitude || !c.longitude) return;
      const s = styleFromCoverage(c.media_coverage);

      const marker = L.circleMarker([+c.latitude, +c.longitude], {
        radius: s.radius,
        color: s.color,
        fillColor: s.color,
        fillOpacity: 0.9
      }).addTo(map);

      marker.on("click", () => openPanel(c));
    });
  }
});
  </script>
</body>
</html>
