<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Boulder County Homicides: Official Story vs. Community Memory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <!-- STYLE -->
  <style>
    * { box-sizing: border-box; }
    html, body {
      height: 100%; margin: 0; padding: 0;
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    #map { position: absolute; inset: 0; }

    /* HEADER */
    .map-header {
      position: absolute;
      top: 16px; left: 16px;
      padding: 14px 18px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(14px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      z-index: 1000;
      max-width: 520px;
    }
    .map-header-title {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #9ca3af;
    }
    .map-header-main {
      font-size: 18px;
      font-family: Georgia, serif;
      font-weight: 600;
      color: #f9fafb;
      margin: 6px 0;
    }
    .map-header-sub {
      font-size: 12px;
      color: #9ca3af;
      line-height: 1.4;
    }

    /* LEGEND */
    .map-legend {
      position: absolute;
      bottom: 16px; left: 16px;
      padding: 14px 16px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(14px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      z-index: 1000;
      font-size: 12px;
      color: #d1d5db;
    }
    .legend-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 6px;
      color: #9ca3af;
    }
    .legend-row {
      display: flex; align-items: center; gap: 6px; margin-bottom: 5px;
    }
    .legend-dot {
      width: 12px; height: 12px; border-radius: 999px;
    }
    .legend-dot.high { background: #b91c1c; }
    .legend-dot.medium { background: #f97316; }
    .legend-dot.low { background: #6b7280; }
    .legend-note {
      margin-top: 6px;
      color: #6b7280;
      font-size: 11px;
    }

    /* RIGHT PANEL */
    .panel {
      position: absolute;
      right: -420px;
      top: 0;
      height: 100vh;
      width: 400px;
      background: rgba(15,23,42,0.96);
      border-left: 1px solid rgba(148,163,184,0.4);
      backdrop-filter: blur(14px);
      padding: 24px;
      box-shadow: -4px 0 30px rgba(0,0,0,0.6);
      transition: right 0.35s ease;
      z-index: 2000;
      overflow-y: auto;
    }
    .panel.open { right: 0; }
    .panel h2 {
      font-family: Georgia, serif;
      margin-top: 0;
      margin-bottom: 8px;
      color: #f3f4f6;
    }
    .panel p {
      font-size: 13px;
      line-height: 1.5;
    }

    .close-btn {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 20px;
      cursor: pointer;
      position: absolute;
      right: 16px;
      top: 16px;
    }

    /* HOVER LABEL */
    .hover-label {
      position: absolute;
      padding: 5px 9px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.4);
      border-radius: 8px;
      font-size: 11px;
      pointer-events: none;
      color: #f9fafb;
      white-space: nowrap;
      z-index: 2000;
      display: none;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="hover" class="hover-label"></div>

  <!-- PANEL -->
  <div id="info-panel" class="panel">
    <button class="close-btn" onclick="closePanel()">✕</button>
    <h2 id="panel-title"></h2>
    <p id="panel-location"></p>
    <p id="panel-summary"></p>
    <hr>
    <p><strong>Official Story:</strong> <span id="panel-official"></span></p>
    <p><strong>Community Memory:</strong> <span id="panel-community"></span></p>
    <p><a id="panel-link" href="#" target="_blank">Open Source Link</a></p>
  </div>

  <!-- HEADER UI -->
  <div class="map-header">
    <div class="map-header-title">Explorations in Anthropology · True Crime</div>
    <div class="map-header-main">Boulder County Homicides: Official Story vs. Community Memory</div>
    <div class="map-header-sub">
      Fifteen homicide cases from 1911–2021, mapped to examine how violence is recorded, remembered, or forgotten across Boulder County.
    </div>
  </div>

  <!-- LEGEND UI -->
  <div class="map-legend">
    <div class="legend-title">Media Coverage Intensity</div>
    <div class="legend-row"><span class="legend-dot high"></span>High — national / sustained regional</div>
    <div class="legend-row"><span class="legend-dot medium"></span>Medium — revived via cold-case attention</div>
    <div class="legend-row"><span class="legend-dot low"></span>Low — archival only / brief mention</div>
    <div class="legend-note">Glow size scales with coverage intensity.</div>
  </div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Papa Parse CSV Loader -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
/* MAP INIT — CARTO DARK BASEMAP */
const map = L.map('map').setView([40.05, -105.28], 11);

L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
  maxZoom: 19,
  attribution: '&copy; CARTO &copy; OpenStreetMap contributors'
}).addTo(map);


/************
 MARKER STYLE
*************/
function getMarkerStyle(coverage) {
  const c = (coverage || "").toLowerCase();
  if (c.startsWith("high")) return { color: "#b91c1c", radius: 14, glow: 0.55 };
  if (c.startsWith("medium")) return { color: "#f97316", radius: 9, glow: 0.35 };
  return { color: "#6b7280", radius: 6, glow: 0.2 };
}


/************
 HOVER LABEL
*************/
function showHover(e, c) {
  const hover = document.getElementById("hover");
  hover.innerText = c.case_name;
  hover.style.display = "block";
}
function moveHover(e) {
  const hover = document.getElementById("hover");
  hover.style.left = (e.originalEvent.pageX + 12) + "px";
  hover.style.top = (e.originalEvent.pageY + 12) + "px";
}
function hideHover() {
  document.getElementById("hover").style.display = "none";
}


/************
 SLIDE PANEL
*************/
function openPanel(c) {
  document.getElementById("panel-title").innerText = `${c.case_name} (${c.year})`;
  document.getElementById("panel-location").innerText = c.location;
  document.getElementById("panel-summary").innerText = c.summary;
  document.getElementById("panel-official").innerText = c.official_story;
  document.getElementById("panel-community").innerText = c.community_memory;
  document.getElementById("panel-link").href = c.link;

  document.getElementById("info-panel").classList.add("open");
}

function closePanel() {
  document.getElementById("info-panel").classList.remove("open");
}


/************
 LOAD CSV & ADD MARKERS
*************/
Papa.parse("cases.csv", {
  download: true,
  header: true,
  complete: function(results) {
    results.data.forEach(c => {
      if (!c.latitude || !c.longitude) return;

      const style = getMarkerStyle(c.media_coverage);

      const marker = L.circleMarker([+c.latitude, +c.longitude], {
        radius: style.radius,
        color: style.color,
        weight: 1.4,
        fillColor: style.color,
        fillOpacity: 0.85 + style.glow * 0.1
      }).addTo(map);

      marker.on("click", () => openPanel(c));
      marker.on("mouseover", e => showHover(e, c));
      marker.on("mousemove", moveHover);
      marker.on("mouseout", hideHover);
    });
  }
});
  </script>
</body>
</html>
