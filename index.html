<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Boulder County Homicides Interactive Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"/>
  <style>
    html, body { margin:0; height:100%; background:#0a0a0a; }
    #map { position:absolute; inset:0; }

    .panel {
      position:absolute;
      right:-400px;
      top:0;
      width:380px;
      height:100%;
      background:rgba(15,23,42,0.96);
      color:white;
      padding:20px;
      border-left:1px solid rgba(255,255,255,0.1);
      transition:0.3s;
      overflow-y:auto;
      font-family:system-ui,sans-serif;
    }
    .panel.open { right:0; }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="panel" class="panel">
    <h2 id="panel-title"></h2>
    <p id="panel-summary"></p>
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
const map = L.map('map').setView([40.05, -105.28], 11);

L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
  maxZoom: 19
}).addTo(map);

function openPanel(c){
  document.getElementById("panel-title").innerText = c.case_name;
  document.getElementById("panel-summary").innerText = c.summary;
  document.getElementById("panel").classList.add("open");
}

function styleFromCoverage(c){
  c = c.toLowerCase();
  if(c.startsWith("high")) return {color:"#b91c1c",radius:15};
  if(c.startsWith("medium")) return {color:"#f97316",radius:10};
  return {color:"#6b7280",radius:6};
}

let heatPoints = [];

Papa.parse("cases.csv", {
  download: true,
  header: true,
  complete: res => {
    res.data.forEach(c=>{
      if(!c.latitude || !c.longitude) return;

      const lat = +c.latitude, lon = +c.longitude;
      const style = styleFromCoverage(c.media_coverage);

      L.circleMarker([lat, lon], {
        radius: style.radius,
        color: style.color,
        fillColor: style.color,
        fillOpacity:0.9
      }).on("click",()=>openPanel(c)).addTo(map);

      heatPoints.push([lat, lon, parseFloat(c.media_count) || 1]);
    });
    L.heatLayer(heatPoints,{radius:45,blur:30}).addTo(map);
  }
});
</script>

</body>
</html>
